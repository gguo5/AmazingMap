<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Google Visualization</title>
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui.min.js"></script>
        <script src="js/bootstrap.min.js"></script>

        <!-- Le styles -->
        <link href="css/bootstrap.css" rel="stylesheet">
            <link href="css/bootstrap-responsive.css" rel="stylesheet">

                <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
                <!--[if lt IE 9]>
                  <script src="../assets/js/html5shiv.js"></script>
                <![endif]-->

                <script type="text/javascript">
                    $.ajax({
                        'url' : 'countries_test.json',
                        dataType: 'json',
                        success: function(json){
                           
                            ul = $("<ul>");  
                            $.each(json, function(key, country){            
                                ul.append("<li>"+country.name+"<button onclick='addToChart(\""+ country["alpha-2"]+"\",\""+country.name+ "\")' class=\"button\">&#43;</button>"+
                                    "<button onclick='removeFromChart(\""+ country["alpha-2"]+"\");' class=\"button\">&#45;</button></li>");
                            });
                            $("#result").append(ul); 
                        }
                    });
                    
                    
                    
                    google.load('visualization', '1', {packages: ['geochart']});
                    google.setOnLoadCallback(drawVisualization);

                    var data;
                    var geochart;
                    var options;
                    function drawVisualization() {
                        $("#info").draggable();
                
                        data = new google.visualization.DataTable();

                        data.addColumn('string', 'Country');
                        data.addColumn('number', 'Value'); 
                        data.addColumn({type:'string', role:'tooltip'});
                        //data.addColumn({type:'string', role:'tooltip',p:{html:true}});
                        
                        
                        
                        data.addRows([[{v:'AU',f:'Australia'},0,'Lived']]);                   
                        data.addRows([[{v:'CN',f:'China'},1,'Lived']]);
                        data.addRows([[{v:'MY',f:'Malaysia'},2,'Traveled to']]);
                       
                        
                        data1_dummy = google.visualization.arrayToDataTable([
                            ['Country', 'Time Visited'],
                            ['China',1987],
                            ['Australia', 2010],
                            ['Malaysia',2014],
                            ['Vietnam',2014],
                            ['Cambodia',2014]
                        ]);
                                                            
                        //data.addRow(["France",2005]);
                        //var data = new google.visualization.DataTable();
                        //data.addColumn('string', 'Country');
                        //data.addColumn('number', 'VY');
                       
                        
                        /*   var testname = "";
                        var testyear = 0;
                        
                           $.getJSON("countries.json", function(results) {
                          var country = results.countries[0];
                          testname = country.name;
                          testyear = country.year;
                          $("#test").html(testname+testyear);
                          
                           for (var i = 0; i < results.countries.length; i++) {                                 
                                var country = results.countries[i];
                                var name = country.name;
                                var yearVisited = country.year;
                                data.addRow([name, yearVisited]); 
                                
                            }
                        });
                         */
                        
                        
                        var container = document.getElementById('visualization');
                        geochart = new google.visualization.GeoChart(container);
                       
                        options = {};
                        options['backgroundColor']= '#96CBD7';//78cabf
                        var colorAxis = {minValue: 0, maxValue: 5,  colors: ['#438094','#FF9933','#0066FF','#438094','#438094']};                 
                        //var colorAxis =  {minValue: 1987, colors: ['#FF9933', '#66FF66','#0066FF','#CC0000','#996600']};
       
                        options['colorAxis']= colorAxis;
                        options['datalessRegionColor']= 'silver';
                
                        //var legend = {numberFormat: '####', textStyle: {color: 'blue',fontName: 'Verdana', fontSize: 16}};
                        options['legend']= 'none';//hide the colorAxis set to 'none'
                
                        var tooltip = {textStyle: {color: '#008080'}, showColorCode: false};
                        options['tooltip']= tooltip;
                
                
                        
                
                        geochart.draw(data,options);
                
                        google.visualization.events.addListener(geochart, 'select', myClickHandler);
                        function myClickHandler() {
                            var selection = geochart.getSelection();
        
                            // if same city is clicked twice in a row
                            // it is "unselected", and selection = []
                            if(typeof selection[0] !== "undefined") {
                                var country = data.getValue(selection[0].row, 0);
                                var year = data.getValue(selection[0].row, 1);
                              
                                
                                if($('#info').css('display') == 'none')
                                {  
                                    //alert('Country is: ' + country+", and visited in "+year);
                                    $("#country").html(country);
                                    $("#year").html(year);
                                    $("#info").show();
                                }
                                else if ($("#country").html() != country)
                                {
                                    $("#country").html(country);
                                    $("#year").html(year);
                                }
                                else
                                {
                                    $("#info").hide();   
                                }
                                
                                
                                
                            }
                        }//end of my click handler
            
                        /*  function myClickHandler_all(){
                            var selection = geochart.getSelection();
                            var message = '';
                            for (var i = 0; i < selection.length; i++) {
                                var item = selection[i];
                                if (item.row != null && item.column != null) {
                                    var str = data.getFormattedValue(item.row, item.column);
                                    message += '{row:' + item.row + ',column:' + item.column + '} = ' + str + '\n';
                                } else if (item.row != null) {
                                    var str = data.getFormattedValue(item.row, 0);
                                    message += '{row:' + item.row + ', (no column, showing first)} = ' + str + '\n';
                                } else if (item.column != null) {
                                    var str = data.getFormattedValue(0, item.column);
                                    message += '{(no row, showing first), column:' + item.column + '} = ' + str + '\n';
                                }
                            }
                            if (message == '') {
                                message = 'nothing';
                            }
                            alert('You selected ' + message);
                        } //end of myhandlerall
                
                         */
        
    
                    }//end of draw chart
                    
                    function addToChart(code, name) {
                        data.addRows([[{v:code,f:name},data.getNumberOfRows(),'Traveled to']]);  
                        geochart.draw(data,options);
                    }
                    
                    function removeFromChart(code) {
                        
                        var foundRows = data.getFilteredRows([{column: 0, value: code}]);
                        //console.log("Type foundRows" + foundRows[0]);
                        for (var i = 0, maxrows = foundRows.length; i < maxrows; i++) {
                            data.removeRow(foundRows[i]);
                            geochart.draw(data,options);
                        }               
                    }
                 
                </script>
                </head>
                <body style="border: 0 none; overflow: hidden">
                    <div class="wrapper">
                        <div id="mapcontainer">
                            <div id="visualization" style="position: absolute; top: 0; bottom: 0; left: 0; right: 0; z-index: 0;"></div>
                            <div id="info" class="alert alert-warning" style="position: absolute; top: 200px; left: 100px; z-index: 1; background-color: #0066FF; display: none">
                                <span id="country"></span><br />
                                <span id="year"></span>
                            </div>
                        </div>
                    </div>

                    <div class="footer">
                        <p class="muted credit">&copy; AmazingMap 2013</p>

                    </div>
                    <div id="result"></div>

                </body>
                </html>
